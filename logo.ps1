Add-Type -AssemblyName PresentationFramework,System.Windows.Forms

# Generate a random file name for the image
$fileName = "logo_" + (Get-Random -Maximum 99999) + ".png"
$path = "$env:TEMP\$fileName"

# Attempt to download the image, handle exceptions if the download fails
try {
    Invoke-WebRequest -Uri "https://secureitswiss.ch/storage/Settings/1582468020_865.png" -OutFile $path
} catch {
    Write-Warning "Unable to download the image. Continuing without it."
    $path = $null
}

# UI Definition with XAML
$xaml = @"
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="SecureIT Logo" Height="450" Width="600">
    <Grid Background="Black">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <TextBlock Text="Dies hätte auch ein Virus sein können" Foreground="LimeGreen" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,10,0,0"/>
        <Image Source="{0}" Stretch="Uniform" VerticalAlignment="Center" Visibility="{1}"/>
        <ProgressBar Name="progressBar" Minimum="0" Maximum="10" Height="20" VerticalAlignment="Bottom" Grid.Row="1" Margin="10"/>
    </Grid>
</Window>
"@ -f $path, $(if ($path) {'Visible'} else {'Collapsed'})

# Load the XAML and create the window
$reader = New-Object System.IO.StringReader($xaml)
$xmlReader = [System.Xml.XmlReader]::Create($reader)
$window = [Windows.Markup.XamlReader]::Load($xmlReader)

# Find the progress bar by name
$progressBar = $window.FindName("progressBar")

# Timer setup for updating the progress bar
$timer = New-Object System.Windows.Threading.DispatcherTimer
$timer.Interval = [TimeSpan]::FromSeconds(1)
$timer.Add_Tick({
    if ($progressBar.Value -lt $progressBar.Maximum) {
        $progressBar.Value++
    } else {
        $timer.Stop()
    }
})
$timer.Start()

# Show the window
$window.ShowDialog()

# Optionally: Delete the downloaded image after closing the window
if ($path) {
    Remove-Item $path
}
